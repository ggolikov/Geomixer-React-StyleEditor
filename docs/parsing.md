## Загрузка Геомиксера

``` javascript
starter.js
```
1) Вызывается `L.gmx.loadMap` с параметрами карты

2) `L.gmx.loadMap` внутри себя вызывает `L.gmx.loadMapProperties`, создает `new L.gmx.gmxMap` и возвращает промис

Внутри себя `L.gmx.loadMapProperties` вызывает TileSender и получает в ответ дерево слоев. С этим деревом и оциями карты и создается `new L.gmx.gmxMap (mapInfo, options)`. В данном контексте `mapInfo` - это дерево слоев.

`L.gmx.gmxMap` - это, по сути, описание карты и входящих в нее слоев.
В нем хранится информация о слоях, о дереве слоев (целиком объект `mapInfo`).
Важно: здесь обрабатываются слои-sources.

3) Затем с результатом резолва этого промиса (а им является `gmxMap`) вызывается локальная функция `processGmxMap`

4) Внутри `processGmxMap` идт работа с сырым деревом `gmxMap`, то есть с объектом `gmxMap.rawTree`, он же `data`.

Какие операции вообще происходят в `processGmxMap`:
- вычисляется экстент карты (или берется дефолтный зафиксированный экстент)
- если информации о языке нет ни в куках ни в config.js, то используются данные о языке из карты
- инициализируется хедер приложения
- определяются опции `leafletMap` (mapOptions)
- инициализируется `leafletMap`
- устанавливается порядок слоев и приводятся в порядок их z-index'ы
- если есть маска обрезки, слои обрезаются по ней
- инициализируются класеры фото-слоев
- в контекстное меню карты добавляются пункты "добавить маркер" и "центрировать"
- создаются функции запоминания в `localStorage` позиции карты. Это нужно для функции `boxZoom`
- инициализируются контролы карты, в том числе и формата координат
- инициализируется контрол подложек
- инициализируется календарь
- запрещается драг и дроп на карте
- запускается `beforeViewer` у плагинов
- инициализируется `authManager`
- рекурсивно проставляются чекбоксы видимости слоям (внутри объекта `data`)
- дерево сохраняется в `window.oldTree`
- добавляются слои в `queryMapLayers` (в левую панель слоев)
- создается тулбар с иконками
- инициализируется `searchControl`
- загружаются все пользовательские данные
- выполняется мапплет карты нового формата
- из пермалинка проставляется базовая подложка
- из пермалинка загружаются пользовательские объекты
- из пермалинка проставляется `dateIntervals` слоев
- слои добавляются на `leafletMap`
- запускается `afterViewer` у плагинов
- создается скроллбар у левой панели
- экспорируется карта (если загружается из экспортного пермалинка)
